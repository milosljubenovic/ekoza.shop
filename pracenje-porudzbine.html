---
layout: default
title: Praƒáenje Porud≈æbine
---

<div class="bg-gradient-to-b from-slate-900 to-slate-800 min-h-screen py-16">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-5xl font-bold text-white mb-4">üì¶ Praƒáenje Porud≈æbine</h1>
      <p class="text-gray-300 text-lg">Proverite status va≈°e porud≈æbine</p>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl p-8 border border-slate-600 text-center">
      <svg class="animate-spin h-16 w-16 mx-auto mb-4 text-purple-400" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="text-white text-xl">Uƒçitavam podatke o porud≈æbini...</p>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden bg-gradient-to-br from-red-900 to-red-800 rounded-2xl p-8 border border-red-600 text-center">
      <div class="text-6xl mb-4">‚ùå</div>
      <h2 class="text-2xl font-bold text-white mb-4">Porud≈æbina nije pronaƒëena</h2>
      <p class="text-gray-300 mb-6">Molimo proverite broj porud≈æbine i broj telefona.</p>
      <a href="/" class="inline-block bg-white text-red-900 px-6 py-3 rounded-xl font-bold hover:bg-gray-100 transition-colors">
        Povratak na poƒçetnu
      </a>
    </div>

    <!-- Order Details -->
    <div id="orderDetails" class="hidden space-y-6">
      <!-- Status Card -->
      <div class="bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl p-8 border border-slate-600">
        <div class="text-center mb-6">
          <div class="text-6xl mb-4" id="statusEmoji">‚è≥</div>
          <h2 class="text-3xl font-bold text-white mb-2" id="statusText">Na ƒçekanju</h2>
          <p class="text-gray-300" id="statusDescription">Va≈°a porud≈æbina je primljena i ƒçeka obradu.</p>
        </div>
        
        <div class="bg-slate-900 rounded-xl p-4 mb-4">
          <div class="grid grid-cols-2 gap-4 text-center">
            <div>
              <p class="text-sm text-gray-400 mb-1">Broj porud≈æbine</p>
              <p class="text-xl font-bold text-gradient" id="orderId">-</p>
            </div>
            <div>
              <p class="text-sm text-gray-400 mb-1">Datum</p>
              <p class="text-lg font-semibold text-white" id="orderDate">-</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl p-6 border border-slate-600">
        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
          <svg class="w-6 h-6 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          Podaci o kupcu
        </h3>
        <div class="bg-slate-900 rounded-xl p-4 space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-400">Ime:</span>
            <span class="text-white font-semibold" id="customerName">-</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Adresa:</span>
            <span class="text-white font-semibold" id="customerAddress">-</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Grad:</span>
            <span class="text-white font-semibold" id="customerCity">-</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Po≈°tanski broj:</span>
            <span class="text-white font-semibold" id="customerPostalCode">-</span>
          </div>
        </div>
      </div>

      <!-- Items -->
      <div class="bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl p-6 border border-slate-600">
        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
          <svg class="w-6 h-6 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
          </svg>
          Stavke porud≈æbine
        </h3>
        <div id="orderItems" class="space-y-3">
          <!-- Items will be inserted here -->
        </div>
      </div>

      <!-- Totals -->
      <div class="bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl p-6 border border-slate-600">
        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
          <svg class="w-6 h-6 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
          Detalji plaƒáanja
        </h3>
        <div class="bg-slate-900 rounded-xl p-4 space-y-3">
          <div class="flex justify-between text-gray-300">
            <span>Proizvodi:</span>
            <span id="subtotal" class="font-semibold">-</span>
          </div>
          <div class="flex justify-between text-gray-300">
            <span>Dostava:</span>
            <span id="shipping" class="font-semibold">-</span>
          </div>
          <div class="flex justify-between text-gray-300">
            <span>Naƒçin plaƒáanja:</span>
            <span id="paymentMethod" class="font-semibold">-</span>
          </div>
          <div class="border-t border-slate-600 pt-3 flex justify-between text-xl font-bold">
            <span class="text-white">Ukupno:</span>
            <span id="total" class="text-gradient">-</span>
          </div>
        </div>
      </div>

      <!-- Back Button -->
      <div class="text-center">
        <a href="/" class="inline-block bg-gradient-to-r from-purple-600 to-purple-500 text-white px-8 py-3 rounded-xl font-bold hover:from-purple-700 hover:to-purple-600 transition-all">
          Povratak na poƒçetnu
        </a>
      </div>
    </div>
  </div>
</div>

<script>
// Get URL parameters
const urlParams = new URLSearchParams(window.location.search);
const orderId = urlParams.get('order');
const phoneNumber = urlParams.get('phonenumber');

// Fetch order status on page load
document.addEventListener('DOMContentLoaded', async function() {
  if (!orderId || !phoneNumber) {
    showError();
    return;
  }

  try {
    const response = await fetch(`https://get-order-status.7kqq5yynhz.workers.dev/?order=${orderId}&phonenumber=${encodeURIComponent(phoneNumber)}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        order: orderId,
        phonenumber: phoneNumber
      })
    });

    if (!response.ok) {
      throw new Error('Failed to fetch order');
    }

    const data = await response.json();

    if (data.success && data.order) {
      displayOrder(data.order);
    } else {
      showError();
    }
  } catch (error) {
    console.error('Error fetching order:', error);
    showError();
  }
});

function displayOrder(order) {
  // Hide loading, show order details
  document.getElementById('loadingState').classList.add('hidden');
  document.getElementById('orderDetails').classList.remove('hidden');

  // Status
  document.getElementById('statusEmoji').textContent = order.statusDisplay?.emoji || '‚è≥';
  document.getElementById('statusText').textContent = order.statusDisplay?.text || order.status;
  document.getElementById('statusDescription').textContent = order.statusDisplay?.description || '';

  // Order info
  document.getElementById('orderId').textContent = order.orderId;
  document.getElementById('orderDate').textContent = order.orderDate || new Date(order.createdAt).toLocaleDateString('sr-RS');

  // Customer info
  document.getElementById('customerName').textContent = order.customerName;
  document.getElementById('customerAddress').textContent = order.address;
  document.getElementById('customerCity').textContent = order.city;
  document.getElementById('customerPostalCode').textContent = order.postalCode;

  // Items
  const itemsContainer = document.getElementById('orderItems');
  itemsContainer.innerHTML = order.items.map(item => `
    <div class="bg-slate-900 rounded-lg p-4">
      <div class="flex justify-between items-start">
        <div class="flex-1">
          <h4 class="font-semibold text-white mb-1">${item.name}</h4>
          <p class="text-sm text-gray-400">Koliƒçina: ${item.quantity}</p>
          ${item.customization?.color ? `<p class="text-sm text-gray-400">Boja: ${item.customization.color}</p>` : ''}
          ${item.customization?.size ? `<p class="text-sm text-gray-400">Veliƒçina: ${item.customization.size}</p>` : ''}
          ${item.customization?.embroidery ? `<p class="text-sm text-gray-400">Vez: ${item.customization.embroidery}</p>` : ''}
          ${item.customization?.name ? `<p class="text-sm text-gray-400">Ime: ${item.customization.name}</p>` : ''}
        </div>
        <div class="text-right">
          <p class="font-bold text-gradient">${(item.price * item.quantity).toLocaleString('sr-RS')} RSD</p>
          <p class="text-xs text-gray-400">${item.price.toLocaleString('sr-RS')} RSD √ó ${item.quantity}</p>
        </div>
      </div>
    </div>
  `).join('');

  // Totals
  const subtotal = order.total - order.shipping;
  document.getElementById('subtotal').textContent = subtotal.toLocaleString('sr-RS') + ' RSD';
  document.getElementById('shipping').textContent = order.shipping > 0 ? order.shipping.toLocaleString('sr-RS') + ' RSD' : 'Besplatno';
  document.getElementById('paymentMethod').textContent = order.paymentMethod;
  document.getElementById('total').textContent = order.total.toLocaleString('sr-RS') + ' RSD';
}

function showError() {
  document.getElementById('loadingState').classList.add('hidden');
  document.getElementById('errorState').classList.remove('hidden');
}
</script>
